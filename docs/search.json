[{"path":"https://nicholasdavies.github.io/luajr/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 luajr authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://nicholasdavies.github.io/luajr/articles/luajr.html","id":"running-lua-code-lua-and-lua_shell","dir":"Articles","previous_headings":"","what":"Running Lua code: lua() and lua_shell()","title":"Introduction to luajr","text":"get feel luajr run “one-” Lua code R project, use lua() lua_shell(). pass character string lua(), run Lua code: Assignments global variables persist calls lua(): luajr maintains “default Lua state” holds global variables. default Lua state opened first time package function used. can create , separate Lua states, reset default Lua state (see Lua states, ). Assignments local variables persist calls lua(): case, second line returns \"walrus\" local variable my_animal goes scope first call lua() ends, second call lua() referring back global variable my_animal . can include one statement code run lua(): can also use filename argument lua() load run Lua source file, instead running contents string. Call lua_shell() open interactive Lua shell R prompt. can can helpful debugging testing Lua statements.","code":"library(luajr) lua(\"return 'Hello ' .. 'world!'\") #> [1] \"Hello world!\" lua(\"my_animal = 'walrus'\") lua(\"return my_animal\") #> [1] \"walrus\" lua(\"local my_animal = 'donkey'\") lua(\"return my_animal\") #> [1] \"walrus\" lua(\"local my_veg = 'potato'; local my_dish = my_veg .. ' pie'; return my_dish\") #> [1] \"potato pie\""},{"path":"https://nicholasdavies.github.io/luajr/articles/luajr.html","id":"calling-lua-functions-from-r-lua_func","dir":"Articles","previous_headings":"","what":"Calling Lua functions from R: lua_func()","title":"Introduction to luajr","text":"key piece functionality luajr probably lua_func(). allows call Lua functions R. first argument lua_func(), func, string evaluate Lua function. lua_func() returns R function can used call Lua function R. example, can use lua_func() access existing Lua function R: , \"type\" just referring built-Lua function type returns string describing Lua type value passed . can also use lua_func() refer previously defined function default Lua state: can use lua_func() define anonymous Lua function: hood, lua_func() just takes first parameter (string), adds \"return \" front , executes Lua code, registers result function. second argument lua_func(), argcode, also important. argcode determines arguments passed function R translated Lua values use inside function. permissible arg codes : 's': simplest Lua type (default) '': array type '1': 's', require argument length 1 … '9': 's', require argument length 9 'v': pass value 'r': pass reference kinds R values can passed Lua functions, behaviour different arg codes, summarized following table: , nn stands integer greater 1; examples, stands specifically 2. one character argcode every argument function, string “recycled” arguments passed characters argcode string. , example, just passing \"s\" argcode means parameters passed simplest Lua type, argcode \"sr\", first argument argcode \"s\", second argument argcode \"r\", third argument argcode \"s\", etc. vector (logical vector, integer vector, numeric vector, character vector) passed R Lua reference, modifications made elements passed-vector persist back R calling frame. example: Vectors can never resized reference; already-existing elements can changed reference. Lists always passed value, vector elements can either passed value reference depending arg code. order make changes list, needs returned calling function. example: Note examples , modify x[1][1], just x[1]. , even lists passed reference, need modify specific elements vector elements want make changes reference. Setting x[1] = 999 reassign element list x, lists passed reference , effect R object passed . contrast, setting x[1][1] = 999 modifies passed-vector x[1], can passed reference, change R object passed . modify list, return new value function: , returning modified value, can add elements list (f3) change whole entries list (f4).","code":"luatype = lua_func(\"type\") luatype(TRUE) #> [1] \"boolean\" lua(\"function squared(x) return x^2 end\") lua(\"return squared(4)\") #> [1] 16  sq = lua_func(\"squared\") sq(8) #> [1] 64 timestwo = lua_func(\"function(x) return x*2 end\") timestwo(123) #> [1] 246 values = c(1.0, 2.0, 3.0) keep = lua_func(\"function(x) x[1] = 999 end\", \"v\") # passed by value keep(values) print(values) #> [1] 1 2 3  change = lua_func(\"function(x) x[1] = 999 end\", \"r\") # passed by reference change(values) print(values) #> [1] 999   2   3 x = list(1)  f1 = lua_func(\"function(x) x[1][1] = 999; x.a = 42; end\", \"v\") f1(x) print(x) #> [[1]] #> [1] 1  f2 = lua_func(\"function(x) x[1][1] = 999; x.a = 42; end\", \"r\") f2(x) print(x) #> [[1]] #> [1] 999 x = list(1)  f3 = lua_func(\"function(x) x[1][1] = 999; x.a = 42; return x; end\", \"v\") x = f3(x) print(x) #> [[1]] #> [1] 999 #>  #> $a #> [1] 42  f4 = lua_func(\"function(x) x[1] = luajr.numeric({888, 999}); return x; end\", \"v\") x = f4(x) print(x) #> [[1]] #> [1] 888 999 #>  #> $a #> [1] 42"},{"path":"https://nicholasdavies.github.io/luajr/articles/luajr.html","id":"benchmarking","dir":"Articles","previous_headings":"","what":"Benchmarking","title":"Introduction to luajr","text":"way using R packages cpp11 Rcpp allows bridge R code C++ code runs faster R, can use luajr bridge R code Lua code runs faster R. general, C/C++ code runs 5-1,000 times faster equivalent R code. experience, luajr code often presents similar speedup, C/C++ code, worst case, maybe half fast. Sometimes luajr code can faster C/C++, though usually isn’t quite good. use luajr ? Rcpp cpp11 require C++ toolchain (e.g. gcc, clang, etc.) requires long compilation times, whereas luajr doesn’t. means luajr usable C++ compiler isn’t available, compilation times prohibitive annoyance. following section, look two aspects benchmarking. first example, compare different ways passing vectors Lua functions relative R. second example, compare fundamentally difference running whole algorithm Lua versus R.","code":""},{"path":"https://nicholasdavies.github.io/luajr/articles/luajr.html","id":"parameter-passing-example-sum-of-squares","dir":"Articles","previous_headings":"Benchmarking","what":"Parameter passing example: sum of squares","title":"Introduction to luajr","text":"reasonably long vectors, passing reference ('r') faster passing value ('v'), faster passing simplify ('s', '', '1'–'9'). relatively short vectors, passing simplify can avoid overhead, simple operations short vectors, might worth using Lua . illustrate points, code takes numeric vector calculates sum squares, comparing pure R function three alternatives written Lua, respectively passing vector reference, value, simplify. time taken sum v1, v4 v7, depending upon function kind, 2019-era MacBook Pro summarised table: vector 10 elements long, R version wins handily. vector 10,000 elements long, pass--reference Lua version fastest, methods comparable. vector 10,000,000 elements long, story similar. example luajr doesn’t add much speed—function relatively short, certain amount overhead invoking , R function doesn’t overhead transferring control languages.","code":"v1 = rnorm(1e1) v4 = rnorm(1e4) v7 = rnorm(1e7)  lua(\"sum2 = function(x) local s = 0; for i=1,#x do s = s + x[i]*x[i] end; return s end\") sum2 = function(x) sum(x*x) sum2_r = lua_func(\"sum2\", \"r\") sum2_v = lua_func(\"sum2\", \"v\") sum2_s = lua_func(\"sum2\", \"s\")  # Comparing the results of each function: sum2(v1)    # Pure R version #> [1] 14.86151 sum2_r(v1)  # luajr pass-by-reference #> [1] 14.86151 sum2_v(v1)  # luajr pass-by-value #> [1] 14.86151 sum2_s(v1)  # luajr pass-by-simplify #> [1] 14.86151"},{"path":"https://nicholasdavies.github.io/luajr/articles/luajr.html","id":"processing-time-example-logistic-map","dir":"Articles","previous_headings":"Benchmarking","what":"Processing time example: logistic map","title":"Introduction to luajr","text":"Consider following: comparing two different methods (R versus Lua) running parameter sweep logistic map, chaotic dynamical system popularized Bob May 1976 Nature article. output looks like :  times taken function follows: version written Lua around 2,000 times faster version R.","code":"logistic_map_R = function(x0, burn, iter, A) {     result = data.frame(a = rep(A, each = iter), x = 0)          j = 1     for (a in A) {         x = x0         for (i in 1:burn) { x = a * x * (1 - x); }         for (i in 1:iter) { result$x[j] = x; x = a * x * (1 - x); j = j + 1 }     }          return(result) }  logistic_map_L = lua_func( \"function(x0, burn, iter, A)     local dflen = #A * iter     local result = luajr.dataframe(dflen)     result.a = luajr.numeric_r(dflen, 0)     result.x = luajr.numeric_r(dflen, 0)          local j = 1     for k,a in pairs(A) do         local x = x0         for i=1,burn do  x = a * x * (1-x)  end         for i=1,iter do  result.a[j] = a; result.x[j] = x; x = a * x * (1-x); j = j + 1  end     end          return result end\", \"s\") logistic_map = logistic_map_L(0.5, 50, 100, 200:385/100) plot(logistic_map$a, logistic_map$x, pch = \".\")"},{"path":"https://nicholasdavies.github.io/luajr/articles/luajr.html","id":"working-with-lua-states-lua_open-lua_reset","dir":"Articles","previous_headings":"","what":"Working with Lua States: lua_open(), lua_reset()","title":"Introduction to luajr","text":"functions mentioned (lua(), lua_shell(), lua_func()) can also take argument L specifies particular Lua state function operates . L = NULL (default) functions operate default Lua state. can also open alternative Lua states using lua_open(), passing result parameter L, specify function operates specific state. example: lua_close luajr Lua states closed automatically garbage collected R. lua_reset() resets default Lua state: reset non-default Lua state L returned lua_open(), just L = lua_open() . memory previously used L cleaned next garbage collection.","code":"L1 = lua_open() lua(\"a = 2\") lua(\"a = 4\", L = L1) lua(\"return a\") #> [1] 2 lua(\"return a\", L = L1) #> [1] 4 lua(\"a = 2\") lua(\"return a\") #> [1] 2 lua_reset() lua(\"return a\") #> NULL"},{"path":"https://nicholasdavies.github.io/luajr/articles/luajr.html","id":"semi-incomprehensible-notes","dir":"Articles","previous_headings":"","what":"Semi-incomprehensible notes","title":"Introduction to luajr","text":"Note luajr.list() isn’t quite aligned vector types (e.g. luajr.character()), ’s working analogy ’__newindex’ (.e. passing list x function args code 'r' x[1] = \"foo\" doesn’t change underlying list, although x[1][1] = \"foo\" .) general, arguments can expressed lists aren’t ever really passed reference; atomic vector elements reference value. Note logical semantics don’t make huge amount sense Lua due true/false/NA, better explicitly check built-values luajr.TRUE_logical_, luajr.FALSE_logical_, luajr.NA_logical_. integer, numeric, character NA values, can compare luajr.NA_integer_, luajr.NA_real_, luajr.NA_character_.","code":""},{"path":"https://nicholasdavies.github.io/luajr/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Nicholas Davies. Maintainer, author, copyright holder. Mike Pall. Copyright holder.            Author embedded LuaJIT compiler Lua.org, PUC-Rio. Copyright holder.            Authors Lua scripting language","code":""},{"path":"https://nicholasdavies.github.io/luajr/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Davies N (2024). luajr: LuaJIT Scripting. R package version 0.0.0.9000, https://nicholasdavies.github.io/luajr/, https://github.com/nicholasdavies/luajr.","code":"@Manual{,   title = {luajr: LuaJIT Scripting},   author = {Nicholas Davies},   year = {2024},   note = {R package version 0.0.0.9000, https://nicholasdavies.github.io/luajr/},   url = {https://github.com/nicholasdavies/luajr}, }"},{"path":"https://nicholasdavies.github.io/luajr/index.html","id":"luajr-luajit-scripting","dir":"","previous_headings":"","what":"LuaJIT Scripting","title":"LuaJIT Scripting","text":"luajr provides R interface Mike Pall’s LuaJIT, just--time compiler Lua scripting language. allows users run Lua code R. One advantages using luajr LuaJIT runs Lua code fast compilation times, fast execution times, need external toolchain, LuaJIT compiler “built ” luajr package. contrasts e.g. Rcpp, results compiled code fast execution times slow compilation times need invoke external C++ compiler toolchain like gcc clang.","code":""},{"path":"https://nicholasdavies.github.io/luajr/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"LuaJIT Scripting","text":"can install development version luajr GitHub :","code":"# install.packages(\"devtools\") devtools::install_github(\"nicholasdavies/luajr\")"},{"path":"https://nicholasdavies.github.io/luajr/index.html","id":"under-development","dir":"","previous_headings":"","what":"Under development","title":"LuaJIT Scripting","text":"luajr early development. , yet tested work platforms, interface behaviour package subject change without notice.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua.html","id":null,"dir":"Reference","previous_headings":"","what":"Run Lua code — lua","title":"Run Lua code — lua","text":"Runs specified Lua code.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run Lua code — lua","text":"","code":"lua(code, filename = NULL, L = NULL)"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run Lua code — lua","text":"code Lua code block run. filename non-NULL, name file run. L Lua state run code. NULL (default) uses default Lua state luajr.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run Lua code — lua","text":"Lua value(s) returned code block converted R object(s). subset Lua types can converted R objects present. multiple values returned, packaged list.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run Lua code — lua","text":"","code":"twelve <- lua(\"return 3*4\") print(twelve) #> [1] 12"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_func.html","id":null,"dir":"Reference","previous_headings":"","what":"Make a Lua function callable from R — lua_func","title":"Make a Lua function callable from R — lua_func","text":"Takes Lua expression evaluates function provides R function can called invoke Lua function.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_func.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Make a Lua function callable from R — lua_func","text":"","code":"lua_func(func, argcode = \"s\", L = NULL)"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_func.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Make a Lua function callable from R — lua_func","text":"func Lua expression evaluating function. argcode wrap R arguments Lua function. L Lua state run code. NULL (default) uses default Lua state luajr.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_func.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Make a Lua function callable from R — lua_func","text":"R function can called invoke Lua function.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_func.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Make a Lua function callable from R — lua_func","text":"R types can passed Lua : NULL, logical vector, integer vector, numeric vector, string vector, list, external pointer. parameter argcode string one character argument Lua function, recycled needed (e.g. single character apply arguments regardless many ). following, corresponding character acode specific argument referred argcode. NULL argument length 0, result Lua nil regardless corresponding argcode. logical, integer, double, character vectors, corresponding argcode 's' (simplify), R vector length one, supplied Lua primitive (boolean, number, number, string, respectively), length > 1, array, .e. table integer indices starting 1. code '', vector always supplied array, even length 1. argcode digit '1' '9', 's', vector required specific length, otherwise error message emitted. Still focusing vectors, argcode 'r', vector passed reference Lua, adopting type luajr.logical_r, luajr.integer_r, luajr.numeric_r, luajr.character_r appropriate. argcode 'v', vector passed value Lua, adopting type luajr.logical, luajr.integer, luajr.numeric, luajr.character appropriate. lists, argcode 's' (simplify), list passed Lua table. entries list non-blank names named table, unnamed entries associated integer key table. Note Lua preserve order entries tables. means R list names often go \"order\" passed Lua 's' returned back R. avoided argcode 'r' 'v'. list passed argcode 'r' 'v', list passed Lua type luajr.list, vector elements list passed reference value, respectively. external pointers, argcode ignored external pointer passed Lua type userdata. function called Lua values returned function, Lua return values converted R values follows. nothing returned, function returns invisible() (.e. NULL). multiple arguments returned, list arguments returned. Reference types (e.g. luajr.logical_r) vector types (e.g. luajr.logical) returned R . luajr.list returned R list. Reference list types respect R attributes set within Lua code. table returned list. list, table entries number key come first (indices 1 n, .e. original number key's value discarded), followed table entries string key (named accordingly). may well scramble order keys, beware. Note particular Lua guarantee traverse table ascending order keys. Entries non-number, non-string keys discarded. probably best avoid returning table anything string keys, use luajr.list.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_func.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Make a Lua function callable from R — lua_func","text":"","code":"squared <- lua_func(\"function(x) return x^2 end\") print(squared(7)) #> [1] 49"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_open.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a new Lua state — lua_open","title":"Create a new Lua state — lua_open","text":"Creates new, empty Lua state returns external pointer wrapping state.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_open.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a new Lua state — lua_open","text":"","code":"lua_open()"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_open.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a new Lua state — lua_open","text":"External pointer wrapping newly created Lua state.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_open.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Create a new Lua state — lua_open","text":"Lua code executed within given Lua state. Lua state similar global environment R, variables functions defined. luajr automatically maintains \"default\" Lua state, users luajr need use lua_open(). However, whatever reason want maintain multiple different Lua states time, independent global variables functions, lua_open() can used create new Lua state can passed lua(), lua_func() lua_shell() via L parameter. functions operate within Lua state instead default one. default Lua state can specified explicitly L = NULL. Note currently way (provided luajr) saving Lua state disk state can restarted later. Also, lua_close luajr Lua states closed automatically garbage collected R.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_open.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create a new Lua state — lua_open","text":"","code":"L1 <- lua_open() lua(\"a = 2\") lua(\"a = 4\", L = L1) lua(\"print(a)\") lua(\"print(a)\", L = L1)"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_reset.html","id":null,"dir":"Reference","previous_headings":"","what":"Reset the default Lua state — lua_reset","title":"Reset the default Lua state — lua_reset","text":"Clears variables default Lua state, freeing associated memory.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_reset.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Reset the default Lua state — lua_reset","text":"","code":"lua_reset()"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_reset.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Reset the default Lua state — lua_reset","text":"resets default Lua state . reset non-default Lua state L returned lua_open(), just L <- lua_open() . memory previously used cleaned next garbage collection.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_reset.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Reset the default Lua state — lua_reset","text":"","code":"lua(\"a = 2\") lua_reset() lua(\"print(a)\") # nil"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_shell.html","id":null,"dir":"Reference","previous_headings":"","what":"Run an interactive Lua shell — lua_shell","title":"Run an interactive Lua shell — lua_shell","text":"interactive mode, provides basic read-eval-print loop LuaJIT.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_shell.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run an interactive Lua shell — lua_shell","text":"","code":"lua_shell(L = NULL)"},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_shell.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run an interactive Lua shell — lua_shell","text":"L Lua state run code. NULL (default) uses default Lua state luajr.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_shell.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run an interactive Lua shell — lua_shell","text":"Nothing.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/lua_shell.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Run an interactive Lua shell — lua_shell","text":"convenience, lines starting equals sign \"=\" replaced \"return \", e.g. entering =x show value x returned R.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/luajr.html","id":null,"dir":"Reference","previous_headings":"","what":"luajr: LuaJIT Scripting — luajr","title":"luajr: LuaJIT Scripting — luajr","text":"'luajr' provides interface Mike Pall's LuaJIT (https://luajit.org), just--time compiler Lua scripting language (https://www.lua.org). allows users run Lua code R.","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/luajr.html","id":"the-r-api","dir":"Reference","previous_headings":"","what":"The R API","title":"luajr: LuaJIT Scripting — luajr","text":"lua(): run Lua code lua_func(): make Lua function callable R lua_shell(): run interactive Lua shell lua_open(): create new Lua state lua_reset(): reset default Lua state","code":""},{"path":"https://nicholasdavies.github.io/luajr/reference/luajr.html","id":"further-reading","dir":"Reference","previous_headings":"","what":"Further reading","title":"luajr: LuaJIT Scripting — luajr","text":"introduction 'luajr', see vignette(\"luajr\")","code":""}]
