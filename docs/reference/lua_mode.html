<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Debugger, profiler, and JIT options — lua_mode • luajr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Debugger, profiler, and JIT options — lua_mode"><meta name="description" content="Run Lua code with the debugger or profiler activated, and control whether
the LuaJIT just-in-time compiler is on."><meta property="og:description" content="Run Lua code with the debugger or profiler activated, and control whether
the LuaJIT just-in-time compiler is on."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">luajr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/luajr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/modules.html">Lua modules</a></li>
    <li><a class="dropdown-item" href="../articles/objects.html">R objects in Lua code</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasdavies/luajr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Debugger, profiler, and JIT options</h1>
      <small class="dont-index">Source: <a href="https://github.com/nicholasdavies/luajr/blob/HEAD/R/lua_mode.R" class="external-link"><code>R/lua_mode.R</code></a></small>
      <div class="d-none name"><code>lua_mode.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run Lua code with the debugger or profiler activated, and control whether
the LuaJIT just-in-time compiler is on.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lua_mode</span><span class="op">(</span><span class="va">expr</span>, <span class="va">debug</span>, <span class="va">profile</span>, <span class="va">jit</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-expr">expr<a class="anchor" aria-label="anchor" href="#arg-expr"></a></dt>
<dd><p>An expression to run with the associated settings. If <code>expr</code> is
present, the settings apply only while <code>expr</code> is being evaluated. If <code>expr</code>
is missing, the settings apply until they are changed by another call to
<code>lua_mode()</code>.</p></dd>


<dt id="arg-debug">debug<a class="anchor" aria-label="anchor" href="#arg-debug"></a></dt>
<dd><p>Control the debugger: <code>"step"</code> / <code>"on"</code> / <code>TRUE</code> to step
through each line; <code>"error"</code> to trigger the debugger on a Lua error;
<code>"off"</code> / <code>FALSE</code> to switch the debugger off.</p></dd>


<dt id="arg-profile">profile<a class="anchor" aria-label="anchor" href="#arg-profile"></a></dt>
<dd><p>Control the profiler: <code>"on"</code> / <code>TRUE</code> to use the profiler's
default settings; a specially formatted string (see below) to control the
profiler's precision and sampling interval; <code>"off"</code> / <code>FALSE</code> to switch the
profiler off.</p></dd>


<dt id="arg-jit">jit<a class="anchor" aria-label="anchor" href="#arg-jit"></a></dt>
<dd><p>Control LuaJIT's just-in-time compiler: <code>"on"</code> / <code>TRUE</code> to use
the JIT, <code>"off"</code> / <code>FALSE</code> to use the LuaJIT interpreter only.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>When called with no arguments, returns the current settings. When
called with <code>expr</code>, calls the value returned by <code>expr</code>. Otherwise, returns
nothing.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is experimental. Its interface and behaviour may change in
subsequent versions of luajr.</p>
<p><code>lua_mode()</code> works in one of three ways, depending on which parameters are
provided.</p>
<p>When called with no arguments, <code>lua_mode()</code> returns the current <code>debug</code>,
<code>profile</code>, and <code>jit</code> settings.</p>
<p>When called without an <code>expr</code> argument, but with at least one of <code>debug</code>,
<code>profile</code>, or <code>jit</code>, the specified settings apply for any subsequent
executions of Lua code until the next call to <code>lua_mode()</code>.</p>
<p>When called with an <code>expr</code> argument, the specified settings for <code>debug</code>,
<code>profile</code>, and <code>jit</code> are applied temporarily just for the evaluation of
<code>expr</code> in the calling frame.</p>
<p>Note that if you provide some but not all of the <code>debug</code>, <code>profile</code>, and
<code>jit</code> arguments, the "missing" settings are retained at their current
values, not reset to some default or "off" state. In other words, you can
temporarily change one setting without affecting the others.</p>
    </div>
    <div class="section level2">
    <h2 id="the-debugger">The debugger<a class="anchor" aria-label="anchor" href="#the-debugger"></a></h2>
    <p>The <code>debug</code> setting allows you to run Lua code in debug mode, using Scott
Lembcke's <a href="https://github.com/slembcke/debugger.lua" class="external-link"><code>debugger.lua</code></a>.</p>
<p>Use <code>debug = "step"</code> (or <code>TRUE</code> or "on") to step through each line of the
code; use <code>debug = "error"</code> to trigger the debugger on any Lua error; and
turn off the debugger with <code>debug = "off"</code> (or <code>FALSE</code>).</p>
<p>To trigger the debugger from a specific place within your Lua code, you can
also call <code>luajr.dbg()</code> from your Lua code. Within Lua, you can also use
<code>luajr.dbg(CONDITION)</code> to trigger debugging only if <code>CONDITION</code> evaluates to
<code>false</code> or <code>nil</code>. (In this way, <code>luajr.dbg(CONDITION)</code> is sort of like an
<code>assert(CONDITION)</code> call that triggers the debugger when the assert fails.)</p>
<p><code>debugger.lua</code> is more fully documented at its
<a href="https://github.com/slembcke/debugger.lua" class="external-link">github repo page</a>, but briefly,
you enter commands of one character at the <code>debugger.lua&gt;</code> prompt. Use
<code>n</code> to step to the next line, <code>q</code> to quit, and <code>h</code> to show a help page with
all the rest of the commands.</p>
    </div>
    <div class="section level2">
    <h2 id="the-profiler">The profiler<a class="anchor" aria-label="anchor" href="#the-profiler"></a></h2>
    <p>The <code>profile</code> setting allows you to profile your Lua code run, generating
information useful for optimising its execution speed.</p>
<p>Use <code>profile = "on"</code> (or <code>TRUE</code>) to turn on the profiler with default
settings (namely, profile at the line level and sample at 10-millisecond
intervals).</p>
<p>Instead of <code>"on"</code>, you can pass a string containing any of these options:</p><ul><li><p><code>f</code>: enable profiling to the function level.</p></li>
<li><p><code>l</code>: enable profiling to the line level.</p></li>
<li><p><code>i&lt;integer&gt;</code>: set the sampling interval, in milliseconds (default: 10ms).</p></li>
<li><p><code>d&lt;integer&gt;</code>: set the maximum stack depth (default: 200).</p></li>
<li><p><code>z&lt;real&gt;</code>: set the maximum profile size, in megabytes (default: 128 Mb).</p></li>
</ul><p>For example, the default options correspond to the string <code>"li10d200z128"</code>
or just <code>"l"</code>.</p>
<p>If the internal buffer gets full (surpasses the limit in megabytes set by
the <code>z</code> option), the profiler will stop recording profiles but Lua code
will continue executing as normal. The truncation will be reported as a
warning by <code><a href="lua_profile.html">lua_profile()</a></code>. The default size, 128 Mb, is sufficient for
about an hour of profiling at 10ms intervals, assuming the average call
stack depth is 10. If you really need to profile something that takes more
than an hour to run, it probably makes more sense to lengthen the sampling
interval rather than increase the maximum profile size. Each Lua state has
its own buffer, so if you are profiling code across multiple Lua states,
this limit applies separately to each one of them.</p>
<p>You must use <code><a href="lua_profile.html">lua_profile()</a></code> to recover the generated profiling data.</p>
    </div>
    <div class="section level2">
    <h2 id="jit-options">JIT options<a class="anchor" aria-label="anchor" href="#jit-options"></a></h2>
    <p>The <code>jit</code> setting allows you to turn LuaJIT's just-in-time compiler off
(with <code>jit = "off"</code> or <code>FALSE</code>). The default is for the JIT compiler to be
<code>"on"</code> (alias <code>TRUE</code>).</p>
<p>Lua code will generally run more slowly with the JIT off, although there
have been issues reported with LuaJIT running more slowly with the JIT on
for processors using ARM64 architecture, which includes Apple Silicon CPUs.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="lua_profile.html">lua_profile()</a></code> for extracting the generated profiling data.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Debugger in "one-shot" mode</span></span></span>
<span class="r-in"><span><span class="fu">lua_mode</span><span class="op">(</span>debug <span class="op">=</span> <span class="st">"on"</span>,</span></span>
<span class="r-in"><span>    <span class="va">sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="lua.html">lua</a></span><span class="op">(</span><span class="st">"</span></span></span>
<span class="r-in"><span><span class="st">        local s = 0</span></span></span>
<span class="r-in"><span><span class="st">        for i = 1,10 do</span></span></span>
<span class="r-in"><span><span class="st">            s = s + i</span></span></span>
<span class="r-in"><span><span class="st">        end</span></span></span>
<span class="r-in"><span><span class="st">        return s</span></span></span>
<span class="r-in"><span><span class="st">    "</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Profiler in "switch on / switch off" mode</span></span></span>
<span class="r-in"><span><span class="fu">lua_mode</span><span class="op">(</span>profile <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pointless_computation</span> <span class="op">=</span> <span class="fu"><a href="lua_func.html">lua_func</a></span><span class="op">(</span></span></span>
<span class="r-in"><span><span class="st">"function()</span></span></span>
<span class="r-in"><span><span class="st">    local s = startval</span></span></span>
<span class="r-in"><span><span class="st">    for i = 1,10^8 do</span></span></span>
<span class="r-in"><span><span class="st">        s = math.sin(s)</span></span></span>
<span class="r-in"><span><span class="st">        s = math.exp(s^2)</span></span></span>
<span class="r-in"><span><span class="st">        s = s + 1</span></span></span>
<span class="r-in"><span><span class="st">    end</span></span></span>
<span class="r-in"><span><span class="st">    return s</span></span></span>
<span class="r-in"><span><span class="st">end"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="lua.html">lua</a></span><span class="op">(</span><span class="st">"startval = 100"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">pointless_computation</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lua_mode</span><span class="op">(</span>profile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="lua_profile.html">lua_profile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Turn off JIT and turn it on again</span></span></span>
<span class="r-in"><span><span class="fu">lua_mode</span><span class="op">(</span>jit <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">lua_mode</span><span class="op">(</span>jit <span class="op">=</span> <span class="st">"on"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Maintained by Nicholas Davies.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

