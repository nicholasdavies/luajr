<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Make a Lua function callable from R — lua_func • luajr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Make a Lua function callable from R — lua_func"><meta name="description" content='Takes any Lua expression (as a character string) that evaluates to a
function and provides an R function that can be called to invoke the Lua
function. Instead of a character string, you can also provide an external
pointer to a Lua function (see examples and the "packages" vignette for more
information).'><meta property="og:description" content='Takes any Lua expression (as a character string) that evaluates to a
function and provides an R function that can be called to invoke the Lua
function. Instead of a character string, you can also provide an external
pointer to a Lua function (see examples and the "packages" vignette for more
information).'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">luajr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.9.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/luajr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/modules.html">Lua modules</a></li>
    <li><a class="dropdown-item" href="../articles/objects.html">R objects in Lua code</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nicholasdavies/luajr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Make a Lua function callable from R</h1>
      <small class="dont-index">Source: <a href="https://github.com/nicholasdavies/luajr/blob/HEAD/R/lua_func.R" class="external-link"><code>R/lua_func.R</code></a></small>
      <div class="d-none name"><code>lua_func.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Takes any Lua expression (as a character string) that evaluates to a
function and provides an R function that can be called to invoke the Lua
function. Instead of a character string, you can also provide an external
pointer to a Lua function (see examples and the "packages" vignette for more
information).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lua_func</span><span class="op">(</span><span class="va">func</span>, argcode <span class="op">=</span> <span class="st">"s"</span>, L <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-func">func<a class="anchor" aria-label="anchor" href="#arg-func"></a></dt>
<dd><p>A character string with a Lua expression evaluating to a
function, or an external pointer to a Lua function.</p></dd>


<dt id="arg-argcode">argcode<a class="anchor" aria-label="anchor" href="#arg-argcode"></a></dt>
<dd><p>How to wrap R arguments for the Lua function.</p></dd>


<dt id="arg-l">L<a class="anchor" aria-label="anchor" href="#arg-l"></a></dt>
<dd><p><a href="lua_open.html">Lua state</a> in which to run the code. <code>NULL</code> (default)
uses the default Lua state for <span class="pkg">luajr</span>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An R function which can be called to invoke the Lua function.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The R types that can be passed to Lua are: <code>NULL</code>, logical vector,
integer vector, numeric vector, string vector, list, external pointer, and
raw.</p>
<p>The parameter <code>argcode</code> is a string with one character for each argument of
the Lua function, recycled as needed (e.g. so that a single character would
apply to all arguments regardless of how many there are).</p>
<p>In the following, the corresponding character of <code>argcode</code> for a specific
argument is referred to as its argcode.</p>
<p>For <code>NULL</code> or any argument with length 0, the result in Lua is <strong>nil</strong>
regardless of the corresponding argcode.</p>
<p>For logical, integer, double, and character vectors, if the corresponding
argcode is <code>'s'</code> (simplify), then if the R vector has length one, it is
supplied as a Lua primitive (boolean, number, number, or string,
respectively), and if length &gt; 1, as an array, i.e. a table with integer
indices starting at 1. If the code is <code>'a'</code>, the vector is always supplied as
an array, even if it only has length 1. If the argcode is the digit <code>'1'</code>
through <code>'9'</code>, this is the same as <code>'s'</code>, but the vector is required to have
that specific length, otherwise an error message is emitted.</p>
<p>Still focusing on the same vector types, if the argcode is <code>'r'</code>, then the
vector is passed <em>by reference</em> to Lua, adopting the type <code>luajr.logical_r</code>,
<code>luajr.integer_r</code>, <code>luajr.numeric_r</code>, or <code>luajr.character_r</code> as appropriate.
If the argcode is <code>'v'</code>, the vector is passed <em>by value</em> to Lua,
adopting the type <code>luajr.logical</code>, <code>luajr.integer</code>, <code>luajr.numeric</code>, or
<code>luajr.character</code> as appropriate.</p>
<p>For a raw vector, only the <code>'s'</code> type is accepted and the result in Lua is
a string (potentially with embedded nulls).</p>
<p>For lists, if the argcode is <code>'s'</code> (simplify), the list is passed as a Lua
table. Any entries of the list with non-blank names are named in the table,
while unnamed entries have the associated integer key in the table. Note that
Lua does not preserve the order of entries in tables. This means that an R
list with names will often go "out of order" when passed into Lua with <code>'s'</code>
and then returned back to R. This is avoided with argcode <code>'r'</code> or <code>'v'</code>.</p>
<p>If a list is passed in with the argcode <code>'r'</code> or <code>'v'</code>, the list is
passed to Lua as type <code>luajr.list</code>, and all vector elements of the list are
passed by reference or by value, respectively.</p>
<p>For external pointers, the argcode is ignored and the external pointer is
passed to Lua as type <strong>userdata</strong>.</p>
<p>When the function is called and Lua values are returned from the function,
the Lua return values are converted to R values as follows.</p>
<p>If nothing is returned, the function returns <code><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible()</a></code> (i.e. <code>NULL</code>).</p>
<p>If multiple arguments are returned, a list with all arguments is returned.</p>
<p>Reference types (e.g. <code>luajr.logical_r</code>) and vector types (e.g.
<code>luajr.logical</code>) are returned to R as such. A <code>luajr.list</code> is returned as an
R list. Reference and list types respect R attributes set within Lua code.</p>
<p>A <strong>table</strong> is returned as a list. In the list, any table entries with a
number key come first (with indices 1 to n, i.e. the original number key's
value is discarded), followed by any table entries with a string key
(named accordingly). This may well scramble the order of keys, so beware.
Note in particular that Lua does not guarantee that it will traverse a table
in ascending order of keys. Entries with non-number, non-string keys are
discarded. It is probably best to avoid returning a <strong>table</strong> with anything
other than string keys, or to use <code>luajr.list</code>.</p>
<p>A Lua string with embedded nulls is returned as an R raw type.</p>
<p>A function is returned as an external pointer, which itself can be converted
into a function that can be called from R, by passing it through <code>lua_func()</code>
as the <code>func</code> argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># use with a character string</span></span></span>
<span class="r-in"><span><span class="va">squared</span> <span class="op">&lt;-</span> <span class="fu">lua_func</span><span class="op">(</span><span class="st">"function(x) return x^2 end"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">squared</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 49</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use with an external pointer to a Lua function</span></span></span>
<span class="r-in"><span><span class="va">times2ptr</span> <span class="op">&lt;-</span> <span class="fu"><a href="lua.html">lua</a></span><span class="op">(</span><span class="st">"return function(x) return 2 * x end"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">times2ptr</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;pointer: 0x14b6853d0&gt;</span>
<span class="r-in"><span><span class="va">times2</span> <span class="op">&lt;-</span> <span class="fu">lua_func</span><span class="op">(</span><span class="va">times2ptr</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">times2</span><span class="op">(</span><span class="fl">14</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 28</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Maintained by Nicholas Davies.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

